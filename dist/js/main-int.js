const loginStore={data:{user:{id_personal:"",id_usuario:"",tipo_usuario:"",usuario:""},userLogged:!1,errors:[]},methods:{login:(e,o)=>new Promise((a,t)=>{axios.get(host+"/log/login?userId="+e+"&password="+o).then(e=>{"OK"==e.data.Result&&(null!=e.data.data?(loginStore.data.user=e.data.data,loginStore.data.userLogged=!0,a(e.data)):t("Usuario incorrecto"))}).catch(e=>{t("Error al conectarse con el servidor")})})}},capaMapStore={data:{basemap:[],imp:"",mzna:{},sector:{},lote:{},ctrl:{},vector2:{},lindero:{},idmap:{},errors:[]},methods:{addCapa(e,o){leyendaStore.data.capas.push({layer:e,name:o})},removeCapa(e){for(let o=0;o<leyendaStore.data.capas.length;o++)leyendaStore.data.capas[o].name==e&&leyendaStore.data.capas.splice(o,1)}}},capaStore={data:{capas:[],capasRol:[],errors:[]},methods:{saveCapaRol(e,o){axios({method:"DELETE",url:host+"/capasuser/delete/"+o}).then(a=>{"OK"==a.data.Result&&(e.forEach(e=>{axios.post(host+"/capasuser/insert",{id_capa:e,tipo_usuario:o}).then(e=>{e.data.Result,$(".configLLoad").hide()}).catch(e=>{capaStore.data.errors.push(e)})}),0==e.length&&$(".configLLoad").hide())}).catch(e=>{capaStore.data.errors.push(e)})},created(){axios.get(host+"/capas").then(e=>{e.data.data.forEach(e=>{e.checked=!1,capaStore.data.capas.push(e)}),$(".configLLoad").hide()}).catch(e=>{capaStore.data.errors.push(e)})},capaRol(e){axios.get(host+"/capasuser?id="+e).then(e=>{capaStore.data.capas.forEach(o=>{o.checked=!1,e.data.data.forEach(e=>{o.id_capa==e.id_capa&&(o.checked=!0)}),$(".configLLoad").hide()})}).catch(e=>{capaStore.data.errors.push(e)})},saveInfo:(e,o,a,t,r)=>new Promise((s,n)=>{let i=new FormData;if("video"==o)i.append("url",e);else for(var p=0;p<e.length;p++){let o=e[p];i.append("url["+p+"]",o)}i.append("tipo",o),i.append("indice",a),i.append("nombre",r),i.append("id_capa",t),axios.post(host+"/url/capa/insert_upd",i,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){s(e.data)}).catch(function(){n()})})}},controlCapaStore={data:{capas:[],capaExternal:[],capaVisible:[],capaMap:[],grupos:[],errors:[],layersFilter:[],capasPop:{},super_grupos:[{id:"1",nombre:"INTERVENCIONES UEFSA",sub_nombre:""},{id:"2",nombre:"PROYECTOS FSA",sub_nombre:"Fondo Sierra Azul"},{id:"3",nombre:"BASE",sub_nombre:""}]},methods:{showList(e){controlCapaStore.data.capas=[],controlCapaStore.data.grupos=[],controlCapaStore.data.capaVisible=[],axios.get(host+"/capasuser/cargar?id="+e).then(e=>{e.data.data.forEach(e=>{e.checked=!0;var o={};o.id_capa=e.id_capa,o.tabla_capa=e.tabla_capa,o.nomb_capa=e.nomb_capa,o.id_grupo=e.tg_config_grupo.id_grupo,o.grupo=e.tg_config_grupo.grupo,o.checked=!0,o.trans=.7,o.trans_show=!1,controlCapaStore.data.capas.push(o),controlCapaStore.data.capaVisible.push({nomb_capa:e.nomb_capa,tabla_capa:e.tabla_capa,visible:!0});var a=!1;if(controlCapaStore.data.grupos.forEach(o=>{o.id_grupo==e.tg_config_grupo.id_grupo&&(a=!0)}),!a){var t={};t.id_grupo=e.tg_config_grupo.id_grupo,t.grupo=e.tg_config_grupo.grupo,t.id_super_grupo=e.tg_config_grupo.id_super_grupo,t.name_visible=e.tg_config_grupo.name_visible,controlCapaStore.data.grupos.push(t)}});controlCapaStore.data.capas.forEach((e,o)=>{var a=new ol.layer.Image({source:new ol.source.ImageWMS({url:geoserver+"/"+workSpace+"/wms",params:{LAYERS:workSpace+":"+e.tabla_capa,SRS:"EPSG:900913",format:"image/png8"},ratio:1,serverType:"geoserver",crossOrigin:"anonymous",transition:0}),opacity:.7});switch(capaMapStore.data.imp+=workSpace+":"+e.tabla_capa+",",e.tabla_capa){case"proyectos_uefmr":controlCapaStore.data.capasPop.proyectos_uefmr=a;break;case"pips_uefmr":controlCapaStore.data.capasPop.pips_uefmr=a;break;case"qo_poligono_cd":controlCapaStore.data.capasPop.qo_poligono_cd=a;break;case"qo_poligono_sd":controlCapaStore.data.capasPop.qo_poligono_sd=a;break;case"qo_evaluacion":controlCapaStore.data.capasPop.qo_evaluacion=a;break;case"qo_ingresadas":controlCapaStore.data.capasPop.qo_ingresadas=a;break;case"qo_aprobadas":controlCapaStore.data.capasPop.qo_aprobadas=a;break;case"qo_concluidas":controlCapaStore.data.capasPop.qo_concluidas=a;break;case"qo_ejecutadas":controlCapaStore.data.capasPop.qo_ejecutadas=a;break;case"qo_liquidadas":controlCapaStore.data.capasPop.qo_liquidadas=a;break;case"qo_observadas":controlCapaStore.data.capasPop.qo_observadas=a;break;case"qo_linea":controlCapaStore.data.capasPop.qo_linea=a;break;case"qo_poligono_sd":controlCapaStore.data.capasPop.qo_poligono_sd=a;break;case"qo_poligono_cd":controlCapaStore.data.capasPop.qo_poligono_cd=a;break;case"bof_poligono":controlCapaStore.data.capasPop.bof_poligono=a;break;case"bof_punto":controlCapaStore.data.capasPop.bof_punto=a;break;case"ref_poligono":controlCapaStore.data.capasPop.ref_poligono=a;break;case"ref_punto":controlCapaStore.data.capasPop.ref_punto=a;break;case"rev_poligono":controlCapaStore.data.capasPop.rev_poligono=a;break;case"rev_punto":controlCapaStore.data.capasPop.rev_punto=a;break;case"am_punto":controlCapaStore.data.capasPop.am_punto=a;break;case"am_linea":controlCapaStore.data.capasPop.am_linea=a;break;case"za_punto":controlCapaStore.data.capasPop.za_punto=a;break;case"za_linea":controlCapaStore.data.capasPop.za_linea=a;break;case"za_poligono":controlCapaStore.data.capasPop.za_poligono=a;break;case"departamentos":controlCapaStore.data.capasPop.sp_departamento=a;break;case"provincias":controlCapaStore.data.capasPop.sp_provincia=a;break;case"distritos":controlCapaStore.data.capasPop.sp_distrito=a;break;case"sp_proyectos":controlCapaStore.data.capasPop.sp_proyectos=a}switch(e.tabla_capa){case"qo_poligono_cd":case"qo_poligono_sd":case"qo_evaluacion":case"qo_ingresadas":case"qo_aprobadas":case"qo_concluidas":case"qo_ejecutadas":case"qo_liquidadas":case"qo_observadas":case"qo_linea":case"bof_poligono":case"bof_punto":case"ref_poligono":case"ref_punto":case"rev_poligono":case"rev_punto":case"am_punto":case"am_linea":case"za_punto":case"za_linea":case"za_poligono":controlCapaStore.data.layersFilter.push(a)}switch(e.tabla_capa){case"qo_poligono_cd":case"qo_poligono_sd":case"qo_evaluacion":case"qo_ingresadas":case"qo_aprobadas":case"qo_concluidas":case"qo_ejecutadas":case"qo_liquidadas":case"qo_observadas":case"qo_linea":case"bof_poligono":case"bof_punto":case"ref_poligono":case"ref_punto":case"rev_poligono":case"rev_punto":case"am_punto":case"am_linea":case"za_punto":case"za_linea":case"za_poligono":case"departamentos":case"provincias":case"distritos":break;default:controlCapaStore.methods.visibleFalse(a,e.nomb_capa,o)}map.addLayer(a),controlCapaStore.data.capaMap.push({capa:a,nombre:e.nomb_capa}),o+1==controlCapaStore.data.capas.length&&map.on("singleclick",function(e){controlCapaStore.methods.displayInfo(e)})}),$(".externalLayerLoad").hide(),map.updateSize()}).catch(e=>{controlCapaStore.data.errors.push(e)})},legendShow(e,o){for(let a=0;a<controlCapaStore.data.capaVisible.length;a++)controlCapaStore.data.capaVisible[a].nomb_capa==e&&(controlCapaStore.data.capaVisible[a].visible=o)},visibleFalse(e,o,a){e.setVisible(!1),controlCapaStore.methods.legendShow(o,!1),controlCapaStore.data.capas[a].checked=!1},displayInfo(e){$("#popup, #popup-content>div").hide();var o=map.getView().getResolution(),a=[];map.forEachLayerAtPixel(e.pixel,function(e,o){a.push(e)});let t=!1;a.forEach(a=>{if("IMAGE"==a.getType()&&!t){let s=a.getSource().getParams().LAYERS.substr(workSpace.length+1);var r=new ol.source.ImageWMS({url:geoserver+"/"+workSpace+"/wms",params:{LAYERS:workSpace+":"+s,SRS:"EPSG:900913"},serverType:"geoserver",transition:0});switch(s){case"pips_uefmr":controlCapaStore.methods.popPips(e,o,r,s,controlCapaStore.data.capasPop.pips_uefmr),t=!0;break;case"proyectos_uefmr":controlCapaStore.methods.popProyectos(e,o,r,s,controlCapaStore.data.capasPop.proyectos_uefmr),t=!0;break;case"sp_interv_obra":controlCapaStore.methods.popIntervObra(e,o,r,s),t=!0;break;case"qo_poligono_cd":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_poligono_cd),t=!0;break;case"qo_poligono_sd":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_poligono_sd),t=!0;break;case"qo_ingresadas":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_ingresadas),t=!0;break;case"qo_evaluacion":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_evaluacion),t=!0;break;case"qo_aprobadas":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_aprobadas),t=!0;break;case"qo_concluidas":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_concluidas),t=!0;break;case"qo_ejecutadas":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_ejecutadas),t=!0;break;case"qo_liquidadas":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_liquidadas),t=!0;break;case"qo_observadas":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_observadas),t=!0;break;case"qo_linea":controlCapaStore.methods.popQocha(e,o,r,s,controlCapaStore.data.capasPop.qo_linea),t=!0;break;case"bof_poligono":controlCapaStore.methods.popBofedal(e,o,r,s,controlCapaStore.data.capasPop.bof_poligono),t=!0;break;case"bof_punto":controlCapaStore.methods.popBofedal(e,o,r,s,controlCapaStore.data.capasPop.bof_punto),t=!0;break;case"ref_poligono":controlCapaStore.methods.popReforest(e,o,r,s,controlCapaStore.data.capasPop.ref_poligono),t=!0;break;case"ref_punto":controlCapaStore.methods.popReforest(e,o,r,s,controlCapaStore.data.capasPop.ref_punto),t=!0;break;case"rev_poligono":controlCapaStore.methods.popReveget(e,o,r,s,controlCapaStore.data.capasPop.rev_poligono),t=!0;break;case"rev_punto":controlCapaStore.methods.popReveget(e,o,r,s,controlCapaStore.data.capasPop.rev_punto),t=!0;break;case"am_punto":controlCapaStore.methods.popAmuna(e,o,r,s,controlCapaStore.data.capasPop.am_punto),t=!0;break;case"am_linea":controlCapaStore.methods.popAmuna(e,o,r,s,controlCapaStore.data.capasPop.am_linea),t=!0;break;case"za_punto":controlCapaStore.methods.popZanja(e,o,r,s,controlCapaStore.data.capasPop.za_punto),t=!0;break;case"za_linea":controlCapaStore.methods.popZanja(e,o,r,s,controlCapaStore.data.capasPop.za_linea),t=!0;break;case"za_poligono":controlCapaStore.methods.popZanja(e,o,r,s,controlCapaStore.data.capasPop.za_poligono),t=!0;break;case"departamentos":controlCapaStore.methods.popPlace(e,o,r,s,controlCapaStore.data.capasPop.sp_departamento),t=!0;break;case"provincias":controlCapaStore.methods.popPlace(e,o,r,s,controlCapaStore.data.capasPop.sp_provincia),t=!0;break;case"distritos":controlCapaStore.methods.popPlace(e,o,r,s,controlCapaStore.data.capasPop.sp_distrito),t=!0;break;case"sp_proyectos":controlCapaStore.methods.popPlace(e,o,r,s,controlCapaStore.data.capasPop.sp_proyectos),t=!0}}})},popSpan(e,o,a){if(null!=e.getElementsByTagName(workSpace+":"+o)[0]){let t=e.getElementsByTagName(workSpace+":"+o)[0].textContent;$("#popup-"+a).text(t),$("#popup-"+a).parent("li").show()}else $("#popup-"+a).parent("li").hide()},popPips(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":pips_uefmr",FEATURE_COUNT:10});if(s&&r.getVisible()){var n="",i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":pips_uefmr")[0]){var o=e.getElementsByTagName(workSpace+":pips_uefmr")[0].getAttribute("fid");n=o.substr(10),$("#popup-nroPip").text(n),controlCapaStore.methods.popSpan(e,"puefmr_proyecto","proyPip"),controlCapaStore.methods.popSpan(e,"puefmr_num","numPip"),controlCapaStore.methods.popSpan(e,"puefmr_snip","snipPip"),controlCapaStore.methods.popSpan(e,"puefmr_desc","descPip"),controlCapaStore.methods.popSpan(e,"puefmr_ubigeo","ubigeoPip"),controlCapaStore.methods.popSpan(e,"puefmr_dep","depPip"),controlCapaStore.methods.popSpan(e,"puefmr_prov","provPip"),controlCapaStore.methods.popSpan(e,"puefmr_dist","distPip"),controlCapaStore.methods.popSpan(e,"puefmr_cuenca","cuencaPip"),controlCapaStore.methods.popSpan(e,"puefmr_miccuenca","micuencaPip"),controlCapaStore.methods.popSpan(e,"puefmr_altitud","altitudPip"),controlCapaStore.methods.popSpan(e,"puefmr_cut","cutPip"),controlCapaStore.methods.popSpan(e,"puefmr_fechain","fechainPip"),controlCapaStore.methods.popSpan(e,"puefmr_inversion","inversionPip"),controlCapaStore.methods.popSpan(e,"puefmr_benef","benefPip"),controlCapaStore.methods.popSpan(e,"puefmr_hect","hectPip"),controlCapaStore.methods.popSpan(e,"puefmr_volf","volfPip"),controlCapaStore.methods.popSpan(e,"puefmr_clasif","clasifPip"),controlCapaStore.methods.popSpan(e,"puefmr_x","xPip"),controlCapaStore.methods.popSpan(e,"puefmr_y","yPip"),$("#popup, #popup-proyecto").hide(),$("#popup, #popup-interv").hide(),$("#popup, #popup-pip").show()}}},i.open("GET",s,!0),i.send();var p=e.coordinate;popup.setPosition(p)}},popProyectos(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n="",i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){var o=e.getElementsByTagName(workSpace+":"+t)[0].getAttribute("fid");n=o.substr(16),$("#popup-nroProy").text(n),controlCapaStore.methods.popSpan(e,"num_pro","num_proProy"),controlCapaStore.methods.popSpan(e,"proyect","proyectProy"),controlCapaStore.methods.popSpan(e,"dep","depProy"),controlCapaStore.methods.popSpan(e,"nivel","nivelProy"),controlCapaStore.methods.popSpan(e,"snip","snipProy"),controlCapaStore.methods.popSpan(e,"cd","cdProy"),controlCapaStore.methods.popSpan(e,"zona","zonaProy"),controlCapaStore.methods.popSpan(e,"x","xProy"),controlCapaStore.methods.popSpan(e,"y","yProy"),controlCapaStore.methods.popSpan(e,"descrip","descripProy"),controlCapaStore.methods.popSpan(e,"ha_bene","ha_beneProy"),controlCapaStore.methods.popSpan(e,"fam_bene","fam_beneProy"),controlCapaStore.methods.popSpan(e,"altitud","altitudProy"),controlCapaStore.methods.popSpan(e,"proyecto","proyectoProy"),controlCapaStore.methods.popSpan(e,"impacto","impactoProy"),controlCapaStore.methods.popSpan(e,"dirfoto","dirfotoProy"),axios.get(host+"/catastro/foto?id="+n).then(e=>{e.data.total>0?($("#popup-foto").show(),$("#popup-foto").attr("src","data:image/jpeg;base64,"+e.data.data[0].img)):$("#popup-foto").hide()}).catch(e=>{}),$("#popup, #popup-pip").hide(),$("#popup, #popup-interv").hide(),$("#popup, #popup-proyecto").show()}}},i.open("GET",s,!0),i.send();var p=e.coordinate;popup.setPosition(p)}},popIntervObra(e,o,a,t){var r=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(r&&capa_la.getVisible()){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){var o=e.getElementsByTagName(workSpace+":"+t)[0].getAttribute("fid");o.substr(15),controlCapaStore.methods.popSpan(e,"cod_obra","obrInt"),controlCapaStore.methods.popSpan(e,"nombre","accionInt"),controlCapaStore.methods.popSpan(e,"nombre_proyecto","proyInt"),controlCapaStore.methods.popSpan(e,"cod_inversion","invInt"),controlCapaStore.methods.popSpan(e,"nomb_lugar_intervenc","lugInt"),controlCapaStore.methods.popSpan(e,"ubicac_geograf_este","esteInt"),controlCapaStore.methods.popSpan(e,"ubicac_geograf_norte","nortInt"),controlCapaStore.methods.popSpan(e,"observacion","obsInt"),controlCapaStore.methods.popSpan(e,"area","refInt"),controlCapaStore.methods.popSpan(e,"longitud","lzanInt"),$("#popup, #popup-pip").hide(),$("#popup, #popup-proyecto").hide(),$("#popup, #popup-interv").show()}}},s.open("GET",r,!0),s.send();var n=e.coordinate;popup.setPosition(n)}},popQocha(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){controlCapaStore.methods.popSpan(e,"longitud","q_longitud"),controlCapaStore.methods.popSpan(e,"altura","q_altura"),controlCapaStore.methods.popSpan(e,"ancho","q_ancho"),controlCapaStore.methods.popSpan(e,"corona","q_corona"),controlCapaStore.methods.popSpan(e,"area_s_dije","q_area_s_dije"),controlCapaStore.methods.popSpan(e,"area_c_dije","q_area_c_dije"),controlCapaStore.methods.popSpan(e,"volumen_x_dije","q_volumen_x_dije"),controlCapaStore.methods.popSpan(e,"cod_obra","q_cod_obra"),controlCapaStore.methods.popSpan(e,"nomb_lugar_intervenc","q_lintervencion"),controlCapaStore.methods.popSpan(e,"cod_inversion","q_cod_inversion"),controlCapaStore.methods.popSpan(e,"cod_expediente","q_cod_expediente"),controlCapaStore.methods.popSpan(e,"nombre_proyecto","q_nombre_proyecto"),controlCapaStore.methods.popSpan(e,"cod_provincia","q_provincia"),controlCapaStore.methods.popSpan(e,"cod_distrito","q_distrito"),controlCapaStore.methods.popSpan(e,"nomb_departamento","q_departamento");let o=e.getElementsByTagName(workSpace+":cod_obra")[0].textContent;controlCapaStore.methods.popInfo(o,"5"),$("#popup, #popup-qo").show()}}},n.open("GET",s,!0),n.send();var i=e.coordinate;popup.setPosition(i)}},popAmuna(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){controlCapaStore.methods.popSpan(e,"longitud","a_longitud"),controlCapaStore.methods.popSpan(e,"ancho","a_ancho"),controlCapaStore.methods.popSpan(e,"cod_obra","a_cod_obra"),controlCapaStore.methods.popSpan(e,"nomb_lugar_intervenc","a_lintervencion"),controlCapaStore.methods.popSpan(e,"cod_inversion","a_cod_inversion"),controlCapaStore.methods.popSpan(e,"cod_expediente","a_cod_expediente"),controlCapaStore.methods.popSpan(e,"nombre_proyecto","a_nombre_proyecto"),controlCapaStore.methods.popSpan(e,"cod_provincia","a_provincia"),controlCapaStore.methods.popSpan(e,"cod_distrito","a_distrito"),controlCapaStore.methods.popSpan(e,"nomb_departamento","a_departamento");let o=e.getElementsByTagName(workSpace+":cod_obra")[0].textContent;controlCapaStore.methods.popInfo(o,"5"),$("#popup, #popup-am").show()}}},n.open("GET",s,!0),n.send();var i=e.coordinate;popup.setPosition(i)}},popZanja(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){controlCapaStore.methods.popSpan(e,"longitud","z_longitud"),controlCapaStore.methods.popSpan(e,"area","z_area"),controlCapaStore.methods.popSpan(e,"cod_obra","z_cod_obra"),controlCapaStore.methods.popSpan(e,"nomb_lugar_intervenc","z_lintervencion"),controlCapaStore.methods.popSpan(e,"cod_inversion","z_cod_inversion"),controlCapaStore.methods.popSpan(e,"cod_expediente","z_cod_expediente"),controlCapaStore.methods.popSpan(e,"nombre_proyecto","z_nombre_proyecto"),controlCapaStore.methods.popSpan(e,"cod_provincia","z_provincia"),controlCapaStore.methods.popSpan(e,"cod_distrito","z_distrito"),controlCapaStore.methods.popSpan(e,"nomb_departamento","z_departamento");let o=e.getElementsByTagName(workSpace+":cod_obra")[0].textContent;controlCapaStore.methods.popInfo(o,"5"),$("#popup, #popup-za").show()}}},n.open("GET",s,!0),n.send();var i=e.coordinate;popup.setPosition(i)}},popReforest(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){controlCapaStore.methods.popSpan(e,"distancia","rf_distancia"),controlCapaStore.methods.popSpan(e,"area","rf_area"),controlCapaStore.methods.popSpan(e,"tipo_esp_forestal","rf_tipo"),controlCapaStore.methods.popSpan(e,"cod_obra","rf_cod_obra"),controlCapaStore.methods.popSpan(e,"nomb_lugar_intervenc","rf_lintervencion"),controlCapaStore.methods.popSpan(e,"cod_inversion","rf_cod_inversion"),controlCapaStore.methods.popSpan(e,"cod_expediente","rf_cod_expediente"),controlCapaStore.methods.popSpan(e,"nombre_proyecto","rf_nombre_proyecto"),controlCapaStore.methods.popSpan(e,"cod_provincia","rf_provincia"),controlCapaStore.methods.popSpan(e,"cod_distrito","rf_distrito"),controlCapaStore.methods.popSpan(e,"nomb_departamento","rf_departamento");let o=e.getElementsByTagName(workSpace+":cod_obra")[0].textContent;controlCapaStore.methods.popInfo(o,"5"),$("#popup, #popup-ref").show()}}},n.open("GET",s,!0),n.send();var i=e.coordinate;popup.setPosition(i)}},popReveget(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){controlCapaStore.methods.popSpan(e,"nro_planta","rv_planta"),controlCapaStore.methods.popSpan(e,"area","rv_area"),controlCapaStore.methods.popSpan(e,"tipo_esp_vegetal","rv_tipo"),controlCapaStore.methods.popSpan(e,"cod_obra","rv_cod_obra"),controlCapaStore.methods.popSpan(e,"nomb_lugar_intervenc","rv_lintervencion"),controlCapaStore.methods.popSpan(e,"cod_inversion","rv_cod_inversion"),controlCapaStore.methods.popSpan(e,"cod_expediente","rv_cod_expediente"),controlCapaStore.methods.popSpan(e,"nombre_proyecto","rv_nombre_proyecto"),controlCapaStore.methods.popSpan(e,"cod_provincia","rv_provincia"),controlCapaStore.methods.popSpan(e,"cod_distrito","rv_distrito"),controlCapaStore.methods.popSpan(e,"nomb_departamento","rv_departamento");let o=e.getElementsByTagName(workSpace+":cod_obra")[0].textContent;controlCapaStore.methods.popInfo(o,"5"),$("#popup, #popup-rev").show()}}},n.open("GET",s,!0),n.send();var i=e.coordinate;popup.setPosition(i)}},popBofedal(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){controlCapaStore.methods.popSpan(e,"area_ini","b_areai"),controlCapaStore.methods.popSpan(e,"area_fin","b_areaf"),controlCapaStore.methods.popSpan(e,"cod_obra","b_cod_obra"),controlCapaStore.methods.popSpan(e,"nomb_lugar_intervenc","b_lintervencion"),controlCapaStore.methods.popSpan(e,"cod_inversion","b_cod_inversion"),controlCapaStore.methods.popSpan(e,"cod_expediente","b_cod_expediente"),controlCapaStore.methods.popSpan(e,"nombre_proyecto","b_nombre_proyecto"),controlCapaStore.methods.popSpan(e,"cod_provincia","b_provincia"),controlCapaStore.methods.popSpan(e,"cod_distrito","b_distrito"),controlCapaStore.methods.popSpan(e,"nomb_departamento","b_departamento");let o=e.getElementsByTagName(workSpace+":cod_obra")[0].textContent;controlCapaStore.methods.popInfo(o,"5"),$("#popup, #popup-bof").show()}}},n.open("GET",s,!0),n.send();var i=e.coordinate;popup.setPosition(i)}},popPlace(e,o,a,t,r){var s=a.getGetFeatureInfoUrl(e.coordinate,o,"EPSG:900913",{INFO_FORMAT:"application/vnd.ogc.gml",LAYERS:workSpace+":"+t,FEATURE_COUNT:10});if(s&&r.getVisible()){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml");if(null!=e.getElementsByTagName(workSpace+":"+t)[0]){var o="",a="";switch(t){case"departamentos":o=e.getElementsByTagName(workSpace+":iddpto")[0].textContent,a="1";break;case"provincias":o=e.getElementsByTagName(workSpace+":idprov")[0].textContent,a="2";break;case"distritos":o=e.getElementsByTagName(workSpace+":iddist")[0].textContent,a="3";break;case"sp_proyectos":o=e.getElementsByTagName(workSpace+":cod_expediente")[0].textContent,a="4"}controlCapaStore.methods.popInfo(o,a)}}},n.open("GET",s,!0),n.send();var i=e.coordinate;popup.setPosition(i)}},popInfo(e,o){infoLayerStore.methods.getLayerinfo(o,e).then(e=>{e.length>0&&o<5&&$("#popup, #popup-infolayer").show()})}}},leyendaStore={data:{capa:[],errors:[]},methods:{}},busquedaStore={data:{proyectos:[],proyectossa:[],acciones:[],departamentos:[],provincias:[],distritos:[],intervenciones:[],dep_checks:[],provinciasInf:[],distritosInf:[],errors:[]},methods:{loadProyectos(e){axios.get(host+"/miriego/listarproyectos?id="+e).then(e=>{busquedaStore.data.proyectos=[],e.data.data.forEach(e=>{busquedaStore.data.proyectos.push(e)}),$(".searchSpacialLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadDepCheck(){axios.get(host+"/miriego/listarDPD").then(e=>{busquedaStore.data.dep_checks=[],e.data.data.forEach(e=>{busquedaStore.data.dep_checks.push(e)}),$(".searchSpacialLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadDepartamentos(){axios.get(host+"/miriego/listardep").then(e=>{busquedaStore.data.departamentos=[],e.data.data.forEach(e=>{busquedaStore.data.departamentos.push(e)}),busquedaStore.data.provincias=[],busquedaStore.data.distritos=[],$(".searchSpacialLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadProvincias(e){axios.get(host+"/miriego/listarprov?id="+e).then(e=>{busquedaStore.data.provincias=[],e.data.data.forEach(e=>{busquedaStore.data.provincias.push(e)}),busquedaStore.data.distritos=[],$(".searchSpacialLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadDistritos(e){axios.get(host+"/miriego/listardist?id="+e).then(e=>{busquedaStore.data.distritos=[],e.data.data.forEach(e=>{busquedaStore.data.distritos.push(e)}),$(".searchSpacialLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadProyectosSa(e){axios.get(host_base+"/proyectos.json").then(e=>{busquedaStore.data.proyectossa=[],e.data.data.forEach(e=>{e.option=e.nombre_proyecto.substring(0,40)+"...",busquedaStore.data.proyectossa.push(e)}),$(".searchSpacialLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadAcciones(e){axios.get(host_base+"/accion.json").then(e=>{busquedaStore.data.acciones=[],e.data.data.forEach(e=>{busquedaStore.data.acciones.push(e)}),$(".searchSpacialLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadIntervenciones(e,o,a){axios.get(host_base+"/intervencion.json").then(e=>{busquedaStore.data.intervenciones=[],e.data.data.forEach(e=>{busquedaStore.data.intervenciones.push(e)}),$(".searchIntervLoad").hide()}).catch(e=>{busquedaStore.data.errors.push(e)})},loadProvinciaProm:e=>new Promise((o,a)=>{busquedaStore.data.provinciasInf=[],axios.get(host+"/miriego/listarprov?id="+e).then(e=>{1==e.data.success&&(null!=e.data.data?(e.data.data.forEach(e=>{busquedaStore.data.provinciasInf.push(e)}),o(e.data)):a("Error al descargar las provincias"))}).catch(e=>{a("Error al conectarse con el servidor")})}),loadDistritosProm:e=>new Promise((o,a)=>{busquedaStore.data.distritosInf=[],axios.get(host+"/miriego/listardist?id="+e).then(e=>{1==e.data.success&&(null!=e.data.data?(e.data.data.forEach(e=>{busquedaStore.data.distritosInf.push(e)}),o(e.data)):a("Error al descargar los distritos"))}).catch(e=>{a("Error al conectarse con el servidor")})})}},rolStore={data:{rols:[],errors:[]},methods:{saveRol(e){axios.post(host+"/roles/create",{rolname:e.rolname,rolpass:e.rolpass}).then(o=>{"OK"==o.data.Result&&(newRol={rolname:e.rolname,rolsuper:!1},rolStore.data.rols.push(newRol),$(".rolLoad").hide())}).catch(e=>{rolStore.data.errors.push(e)})},deleteRol(e){axios.get(host+"/roles/drop?rolname="+e.rolname).then(o=>{"OK"==o.data.Result&&(rolStore.data.rols.splice(e.index,1),$(".rolLoad").hide())}).catch(e=>{rolStore.data.errors.push(e)})},created(){axios.get(host+"/roles").then(e=>{e.data.data.forEach(e=>{rolStore.data.rols.push(e)}),$(".rolLoad").hide()}).catch(e=>{rolStore.data.errors.push(e)})}}},infoLayerStore={data:{infos:[],registros:[],errors:[]},methods:{saveInfo:(e,o,a,t,r)=>new Promise((s,n)=>{let i=new FormData;if("video"==o)i.append("url",e);else for(var p=0;p<e.length;p++){let o=e[p];i.append("url["+p+"]",o)}i.append("tipo",o),i.append("indice",a),i.append("nombre",r),i.append("id_capa",t),axios.post(host+"/url/capa/insert_upd",i,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){s(e.data)}).catch(function(){n()})}),getLayerinfo:(e,o)=>new Promise((a,t)=>{infoLayerStore.data.infos=[],axios.get(host+"/url/capa/by?id_capa="+e+"&indice="+o).then(e=>{e.data.data.forEach(e=>{infoLayerStore.data.infos.push(e)}),a(e.data.data)}).catch(e=>{infoLayerStore.data.errors.push(e),t(response.data)})}),getLayersinfo:(e,o)=>new Promise((e,o)=>{infoLayerStore.data.registros=[],axios.get(host+"/url/capa").then(o=>{o.data.data.forEach(e=>{infoLayerStore.data.registros.push(e)}),$(".infoLLoad").hide(),e(o.data.data)}).catch(e=>{infoLayerStore.data.errors.push(e),o()})}),deleteInfo:e=>new Promise((o,a)=>{axios({method:"DELETE",url:host+"/url/capa/eliminar?id_url_capa="+e}).then(e=>{o()}).catch(e=>{infoLayerStore.data.errors.push(e),a()})})}};function addInteraction(){draw=new ol.interaction.Draw({source:source,type:"Polygon"}),map.addInteraction(draw)}function layerVisible(){listLayers.forEach(e=>{e.setVisible(!1)})}Vue.component("logged",{data:()=>({}),methods:{},mounted(){}}),Vue.component("cm-leyenda",{template:"#cm-leyenda-template",data:()=>({imgUrl:geoserver+"/"+workSpace+"/wms?TRANSPARENT=TRUE&SERVICE=WMS&REQUEST=GetLegendGraphic&FORMAT=image%2Fgif&LAYER=",controlCapaStore:controlCapaStore.data}),methods:{aqui(){}}}),Vue.component("cm-basemap",{template:"#cm-basemap-template",data:()=>({basemapStore:[{id:1,name:"OpenStreet Map",img:"m-osm.jpg"},{id:2,name:"Bing Maps",img:"m-bing-road.png"},{id:3,name:"Bing Aerial",img:"m-bing-sat.jpg"},{id:6,name:"Topográfico",img:"m-topo.jpg"},{id:7,name:"National Geographic",img:"m-natgeo.jpg"},{id:8,name:"Imágenes",img:"m-imagery.jpg"},{id:10,name:"Océanos",img:"m-ocean.jpg"},{id:11,name:"Lona gris oscuro",img:"m-dark-grey.png"},{id:12,name:"Lona gris claro",img:"m-light-gray.jpg"},{id:13,name:"Terreno con etiquetas",img:"m-terrain.png"},{id:14,name:"Calles",img:"m-street.jpg"},{id:15,name:"Google Maps",img:"m-google-road.png"},{id:16,name:"Google Satelite",img:"m-google-sat.png"}],selectBase:1}),methods:{changeBase(){switch(layerVisible(),this.selectBase){case 1:osm.setVisible(!0);break;case 2:bing.setVisible(!0);break;case 3:bingAerial.setVisible(!0);break;case 6:topografico.setVisible(!0);break;case 7:natgeo.setVisible(!0);break;case 8:imagery.setVisible(!0);break;case 10:oceanos.setVisible(!0);break;case 11:darkgrey.setVisible(!0);break;case 12:lightgray.setVisible(!0);break;case 13:terrenoLabels.setVisible(!0);break;case 14:calles.setVisible(!0);break;case 15:google2.setVisible(!0);break;case 16:googles2.setVisible(!0);break;default:osm.setVisible(!0)}}},created(){$(".baseMapLoad").hide()}}),Vue.component("cm-externallayer",{template:"#cm-externallayer-template",data:()=>({controlCapaStore:controlCapaStore.data,geoserver:geoserver+"/"+workSpace,workSpace:workSpace,transparency:[]}),methods:{changeLayer(e){this.controlCapaStore.capaMap.forEach((o,a)=>{if(o.nombre==e){var t=!o.capa.getVisible();o.capa.setVisible(t),controlCapaStore.data.capas[a].checked=t,controlCapaStore.methods.legendShow(e,o.capa.getVisible())}})},changeTrans(e,o){controlCapaStore.data.capaMap[e].capa.setOpacity(parseFloat(o)+1)},OpenTrans(e){this.controlCapaStore.capas.forEach(o=>{o.nomb_capa==e.nomb_capa&&(o.trans_show=!e.trans_show)})}},created(){$(".externalLayerLoad").show(),1==loginStore.data.userLogged&&controlCapaStore.methods.showList(loginStore.data.user.tipo_usuario)}}),Vue.component("icm-trans",{props:["fill"],template:"#icm-trans",methods:{}}),Vue.component("cm-configlayer",{template:"#cm-configlayer-template",data:()=>({rolStore:rolStore.data,capaStore:capaStore.data,rolSelect:"",disabledConfL:"disabled"}),methods:{saveConfigLayer(){$(".configLLoad").show();var e=[];$("#configLayer-list tr input:checked").each(function(){e.push($(this).data("layer-index"))}),capaStore.methods.saveCapaRol(e,this.rolSelect)},changeRol(){$(".configLLoad").show(),""!=this.rolSelect?(this.disabledConfL="",capaStore.methods.capaRol(this.rolSelect)):(this.disabledConfL="disabled",capaStore.methods.created())}},created(){1==loginStore.data.userLogged&&"gl_administrador"==loginStore.data.user.tipo_usuario&&(rolStore.methods.created(),capaStore.methods.created())}}),Vue.component("cm-infolayer",{template:"#cm-infolayer-template",data:()=>({spacialStore:busquedaStore.data,infoLayerStore:infoLayerStore.data,loginStore:loginStore.data,nivel:"",selDep:"",selProv:"",selDist:"",selFormato:5,cod_obra:"",cod_proy:"",url:"",nombre:"",images:[],distritos:[],provincias:[],stateForm:!1,stateNivel:"departamento",stateService:!1,errorFile:!1,errorFileTxt:""}),methods:{changeDepartamentos(){$(".infoLLoad").show(),this.provincias=[],busquedaStore.methods.loadProvinciaProm(this.selDep).then(e=>{$(".infoLLoad").hide()}).catch(e=>{})},changeProvincias(){$(".infoLLoad").show(),this.provincias=[],busquedaStore.methods.loadDistritosProm(this.selProv).then(e=>{$(".infoLLoad").hide()}).catch(e=>{})},registerInformacion(){$(".infoLLoad").show();let e="";switch(this.nivel){case"1":e=("0"+this.selDep).slice(-2);break;case"2":e=("000"+this.selProv).slice(-4);break;case"3":e=("00000"+this.selDist).slice(-6);break;case"4":e=this.cod_proy;break;case"5":e=this.cod_obra}let o="";switch(this.selFormato){case"video":o=this.url;break;case"grafico":case"mapa":case"foto":case"documento":case"infografia":o=this.images;break;default:return!1}capaStore.methods.saveInfo(o,this.selFormato,e,this.nivel,this.nombre).then(e=>{e.success?(infoLayerStore.methods.getLayersinfo().then(()=>{$(".infoLLoad").hide()}),this.stateForm=!1):$(".infoLLoad").hide();this.stateService=!0}).catch(e=>{$(".infoLLoad").hide(),this.stateService=!0})},stateClose(){this.stateService=!1},handleFilesUploadImg(){$(".infoLLoad").show();let e=this.$refs.imagen.files;this.images=[];let o=5359236;this.errorFileTxt="El tamaño maximo del archivo puede ser 5MB","mapa"==this.selFormato&&(o=10659236,this.errorFileTxt="El tamaño maximo del archivo puede ser 10MB");for(var a=0;a<e.length;a++)e[a].size<o?(this.images.push(e[a]),a==e.length-1&&$(".infoLLoad").hide(),this.errorFile=!1):(this.errorFile=!0,$(".infoLLoad").hide())},deleteReg(e){$(".infoLLoad").show(),infoLayerStore.methods.deleteInfo(e).then(()=>{infoLayerStore.methods.getLayersinfo().then(()=>{$(".infoLLoad").hide()}),this.stateService=!0})},addReg(){this.stateForm=!this.stateForm,this.stateService=!1,this.nivel="",this.selDep="",this.selProv="",this.selDist="",this.selFormato="",this.cod_obra="",this.cod_proy="",this.url="",this.nombre="",this.images=[]}},computed:{inf_dep(){return this.infoLayerStore.registros.filter(e=>"1"==e.id_capa)},inf_prov(){return this.infoLayerStore.registros.filter(e=>"2"==e.id_capa)},inf_dist(){return this.infoLayerStore.registros.filter(e=>"3"==e.id_capa)},inf_proy(){return this.infoLayerStore.registros.filter(e=>"4"==e.id_capa)},inf_obra(){return this.infoLayerStore.registros.filter(e=>"5"==e.id_capa)}},created(){$(".infoLLoad").hide(),infoLayerStore.methods.getLayersinfo()}}),Vue.component("cm-searchspacial",{template:"#cm-searchspacial-template",data:()=>({spacialStore:busquedaStore.data,selDep:"",selProv:"",selDist:"",selProy:""}),methods:{changeDepartamentos(){busquedaStore.methods.loadProvincias(this.selDep);var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':departamentos" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="departamentos.'+this.selDep+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:posList"),o=e[e.length-1].textContent.split(" "),a=[];for(let e=0;e<o.length;e+=2)a.push([parseFloat(o[e]),parseFloat(o[e+1])]);var t=new ol.geom.MultiPoint(a);map.getView().fit(t,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},changeProvincias(){busquedaStore.methods.loadDistritos(this.selProv);var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':provincias" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="provincias.'+this.selProv+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:posList")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.MultiPoint(o);map.getView().fit(a,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},changeDistritos(){busquedaStore.methods.loadProyectos(this.selDist);var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':distritos" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="distritos.'+this.selDist+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:posList")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.MultiPoint(o);map.getView().fit(a,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},changeProyectos(){var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':proyectos_uefmr" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="proyectos_uefmr.'+this.selProy+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:pos")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.Point(o[0],o[1]);map.getView().fit(a,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)}},created(){1==loginStore.data.userLogged&&busquedaStore.methods.loadDepartamentos()}}),Vue.component("cm-searchtitular",{template:"#cm-searchtitular-template",data:()=>({titularStore:busquedaStore.data,titularSearch:""}),methods:{buscarTitular(){$(".searchTitularLoad").show(),busquedaStore.methods.loadTitulares(this.titularSearch)},mapTitular(e){var o='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="mdttambo:sp_formularios" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="sp_formularios.'+e+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:pos")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.Point(o[0],o[1]);map.getView().fit(a,map.getSize())}},a.open("POST",geoserver+"/wfs",!0),a.setRequestHeader("Content-Type","text/xml"),a.send(o)}},created(){1==loginStore.data.userLogged&&$(".searchTitularLoad").hide()}}),Vue.component("cm-searchintervencion",{template:"#cm-searchintervencion-template",data:()=>({intervStore:busquedaStore.data,selDep:"",selProv:"",selDist:"",selProy:"",selInt:"",selEst:"",codInv:"",codObra:"",qocha:{longitud_s:"=",longitud:"",ancho_s:"=",ancho:"",altura_s:"=",altura:"",corona_s:"=",corona:"",area_cd_s:"=",area_cd:"",area_sd_s:"=",area_sd:"",volumen_s:"=",volumen:""},amuna:{ancho_s:"=",ancho:"",longitud_s:"=",longitud:""},zanja:{longitud_s:"=",longitud:"",area_s:"=",area:""},reforestacion:{area_s:"=",area:"",distancia_s:"=",distancia:""},revegetacion:{area_s:"=",area:"",n_plantas_s:"=",n_plantas:""},bofedal:{area_i_s:"=",area_i:"",area_f_s:"=",area_f:""}}),methods:{changeDepartamentos(){busquedaStore.methods.loadProvincias(this.selDep);var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':departamentos" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="departamentos.'+this.selDep+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:posList"),o=e[e.length-1].textContent.split(" "),a=[];for(let e=0;e<o.length;e+=2)a.push([parseFloat(o[e]),parseFloat(o[e+1])]);var t=new ol.geom.MultiPoint(a);map.getView().fit(t,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},changeProvincias(){busquedaStore.methods.loadDistritos(this.selProv);var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':provincias" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="provincias.'+this.selProv+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:posList")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.MultiPoint(o);map.getView().fit(a,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},changeDistritos(){busquedaStore.methods.loadProyectosSa(this.selDist);var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':distritos" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="distritos.'+this.selDist+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:posList")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.MultiPoint(o);map.getView().fit(a,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},changeProyectos(){busquedaStore.methods.loadAcciones(this.selInt);var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':proyectos_uefmr" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="proyectos_uefmr.'+this.selProy+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:pos")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.Point(o[0],o[1]);map.getView().fit(a,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},changeAccion(){var e='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':sp_intervencion" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="sp_intervencion.'+this.selInt+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:pos")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.Point(o[0],o[1]);map.getView().fit(a,map.getSize())}},o.open("POST",geoserver+"/wfs",!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e)},filtrarMap(){var e=[];let o="",a="";var t=$('.placeDep input[type="checkbox"]:checked');$.each(t,(e,o)=>{a+="'"+o.dataset.coddept+"'",e!=t.length-1&&(a+=", ")}),t.length>0&&(a="nomb_departamento IN ("+a+")"),o=a;let r="";var s=$('.placeDep input[type="checkbox"]:not(:checked)').parent().siblings(".row").find('.placeProv input[type="checkbox"]:checked');$.each(s,(e,o)=>{r+="'"+o.dataset.codprov+"'",e!=s.length-1&&(r+=", ")}),s.length>0&&(r="cod_provincia IN ("+r+")"),""!=o&&""!=r&&(o+=" OR "),o+=r;let n="";var i=$('.placeProv input[type="checkbox"]:not(:checked)').parent().siblings(".row").find('input[type="checkbox"]:checked');$.each(i,(e,o)=>{n+="'"+o.dataset.coddist+"'",e!=i.length-1&&(n+=", ")}),i.length>0&&(n="cod_distrito IN ("+n+")"),""!=o&&""!=n&&(o+=" OR "),o+=n;let p="";""!=this.codObra&&(p=" AND cod_obra = '"+this.codObra+"'");let c="";""!=this.codInv&&(c=" AND cod_inversion = '"+this.codInv+"'");let l="";0!=this.selInt&&(l=" AND id_tipo_accion = '"+this.selInt+"'",1==this.selInt&&(l+=this.getQocha()),2==this.selInt&&(l+=this.getAmuna()),3==this.selInt&&(l+=this.getZanja()),4==this.selInt&&(l+=this.getReforestacion()),5==this.selInt&&(l+=this.getRevegetacion()),6==this.selInt&&(l+=this.getBofedal()));let d="";0!=this.selEst&&(d=" AND id_est_obra = '"+this.selEst+"'"),e.CQL_FILTER="("+o+")"+p+c+l+d,controlCapaStore.data.layersFilter.forEach(o=>{o.getSource().updateParams(e)})},getQocha(){var e="",o=[this.qocha.longitud,this.qocha.ancho,this.qocha.altura,this.qocha.corona,this.qocha.area_cd,this.qocha.area_sd,this.qocha.volumen],a=[this.qocha.longitud_s,this.qocha.ancho_s,this.qocha.altura_s,this.qocha.corona_s,this.qocha.area_cd_s,this.qocha.area_sd_s,this.qocha.volumen_s];return""!=o[0]&&(""==e&&(e+=" AND "),e+="longitud "+a[0]+" '"+o[0]+"'"),""!=o[1]&&(""==e&&(e+=" AND "),e+="ancho "+a[1]+" '"+o[1]+"'"),""!=o[2]&&(""==e&&(e+=" AND "),e+="altura "+a[2]+" '"+o[2]+"'"),""!=o[3]&&(""==e&&(e+=" AND "),e+="corona "+a[3]+" '"+o[3]+"'"),""!=o[4]&&(""==e&&(e+=" AND "),e+="area_cd "+a[4]+" '"+o[4]+"'"),""!=o[5]&&(""==e&&(e+=" AND "),e+="area_sd "+a[5]+" '"+o[5]+"'"),""!=o[6]&&(""==e&&(e+=" AND "),e+="volumen "+a[6]+" '"+o[6]+"'"),e},getAmuna(){var e="",o=[this.amuna.longitud,this.amuna.ancho],a=[this.amuna.longitud_s,this.amuna.ancho_s];return""!=o[0]&&(""==e&&(e+=" AND "),e+="longitud "+a[0]+" '"+o[0]+"'"),""!=o[1]&&(""==e&&(e+=" AND "),e+="ancho "+a[1]+" '"+o[1]+"'"),e},getZanja(){var e="",o=[this.zanja.longitud,this.zanja.area],a=[this.zanja.longitud_s,this.zanja.area_s];return""!=o[0]&&(""==e&&(e+=" AND "),e+="longitud "+a[0]+" '"+o[0]+"'"),""!=o[1]&&(""==e&&(e+=" AND "),e+="area "+a[1]+" '"+o[1]+"'"),e},getReforestacion(){var e="",o=[this.reforestacion.area,this.reforestacion.distancia],a=[this.reforestacion.area_s,this.reforestacion.distancia_s];return""!=o[0]&&(""==e&&(e+=" AND "),e+="area "+a[0]+" '"+o[0]+"'"),""!=o[1]&&(""==e&&(e+=" AND "),e+="distancia "+a[1]+" '"+o[1]+"'"),e},getRevegetacion(){var e="",o=[this.revegetacion.area,this.revegetacion.n_plantas],a=[this.revegetacion.area_s,this.revegetacion.n_plantas_s];return""!=o[0]&&(""==e&&(e+=" AND "),e+="area "+a[0]+" '"+o[0]+"'"),""!=o[1]&&(""==e&&(e+=" AND "),e+="nro_planta "+a[1]+" '"+o[1]+"'"),e},getBofedal(){var e="",o=[this.bofedal.area_i,this.bofedal.area_f],a=[this.bofedal.area_i_s,this.bofedal.area_f_s];return""!=o[0]&&(""==e&&(e+=" AND "),e+="area_ini "+a[0]+" '"+o[0]+"'"),""!=o[1]&&(""==e&&(e+=" AND "),e+="area_fin "+a[1]+" '"+o[1]+"'"),e}},created(){1==loginStore.data.userLogged&&busquedaStore.methods.loadDepartamentos(),busquedaStore.methods.loadDepCheck(),busquedaStore.methods.loadAcciones()}}),Vue.component("cm-searchintervtable",{template:"#cm-searchintervtable-template",data:()=>({intervtStore:busquedaStore.data,proyectoSearch:"",selAcc:"",intervencionSearch:"",searchOn:!0}),methods:{buscarProyecto(){this.searchOn=!1,$(".searchIntervLoad").show(),busquedaStore.methods.loadIntervenciones(this.proyectoSearch,this.selAcc,this.intervencionSearch)},regresarBuscar(){this.searchOn=!0},mapInterv(e){var o='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"><wfs:Query typeName="'+workSpace+':sp_intervencion" srsName="EPSG:900913"> <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"> <ogc:FeatureId fid="sp_intervencion.'+e+'"/></ogc:Filter></wfs:Query></wfs:GetFeature>',a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=(new DOMParser).parseFromString(this.response,"text/xml").getElementsByTagName("gml:pos")[0].textContent.split(" "),o=[];for(let a=0;a<e.length;a+=2)o.push([parseFloat(e[a]),parseFloat(e[a+1])]);var a=new ol.geom.Point(o[0],o[1]);map.getView().fit(a,map.getSize())}},a.open("POST",geoserver+"/wfs",!0),a.setRequestHeader("Content-Type","text/xml"),a.send(o)}},created(){1==loginStore.data.userLogged&&$(".searchIntervLoad").hide()}}),Vue.component("cm-coordenadas",{template:"#cm-coordenadas-template",data:()=>({coorLongitud:"",coorLatitud:"",coorZoom:"",coorSR:"EPSG:4326"}),methods:{showCoordenada(){var e=map.getView(),o=ol.proj.get("EPSG:3857"),a=(ol.proj.get(this.coorSR),[parseFloat(this.coorLongitud),parseFloat(this.coorLatitud)]),t=ol.proj.transform(a,this.coorSR,o);e.animate({zoom:this.coorZoom,center:t,duration:500})}},created(){proj4.defs("EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),proj4.defs("EPSG:4326","+proj=longlat +datum=WGS84 +no_defs"),proj4.defs("EPSG:24877","+proj=utm +zone=17 +south +ellps=intl +towgs84=-288,175,-376,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:24878","+proj=utm +zone=18 +south +ellps=intl +towgs84=-288,175,-376,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:24879","+proj=utm +zone=19 +south +ellps=intl +towgs84=-288,175,-376,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:32717","+proj=utm +zone=17 +south +datum=WGS84 +units=m +no_defs"),proj4.defs("EPSG:32718","+proj=utm +zone=18 +south +datum=WGS84 +units=m +no_defs"),proj4.defs("EPSG:32719","+proj=utm +zone=19 +south +datum=WGS84 +units=m +no_defs")}}),Vue.component("cm-contacto",{template:"#cm-contacto-template",data:()=>({}),methods:{}}),Vue.component("cm-wmskml",{template:"#cm-wmskml-template",data:()=>({wmsNameNew:"",wmsLayerNew:"",wmsNew:"",WMSMessage:"",kmlNameNew:"",kmlNew:"",KMLMessage:"",tipo_layer:"wms"}),methods:{addWMS(){var e=new ol.layer.Image({source:new ol.source.ImageWMS({url:this.wmsNew,params:{LAYERS:this.wmsLayerNew,SRS:"EPSG:900913"},serverType:"geoserver",crossOrigin:"anonymous",transition:0}),opacity:.7});map.addLayer(e),this.WMSMessage="Se agrego la capa exitosamente";var o={id_capa:0,tabla_capa:""};o.nomb_capa=this.wmsNameNew,o.id_grupo=-1,o.grupo="Capas externas",o.checked=!0;var a=!1;if(controlCapaStore.data.super_grupos.forEach(e=>{"CAPAS EXTERNAS"==e.nombre&&(a=!0)}),!a){var t={id:0,nombre:"CAPAS EXTERNAS"};controlCapaStore.data.super_grupos.push(t)}var r=!1;if(controlCapaStore.data.grupos.forEach(e=>{"Capas externas"==e.grupo&&(r=!0)}),!r){t={id_grupo:-1,grupo:"Capas externas",id_super_grupo:0,name_visible:!1};controlCapaStore.data.grupos.push(t)}controlCapaStore.data.capas.push(o),controlCapaStore.data.capaMap.push({capa:e,nombre:this.wmsNameNew}),controlCapaStore.data.capaVisible.push({capa:e,nomb_capa:this.wmsNameNew,visible:!0})},addKML(){var e=$("#filekml")[0].files[0],o=new FileReader;o.onload=function(){var e=o.result,a=new ol.format.KML({extractStyles:!0,extractAttributes:!0,maxDepth:2}),t=new ol.source.Vector({params:{SRS:"EPSG:3857"},crossOrigin:"anonymous"});t.addFeatures(a.readFeatures(e,{dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"}));var r=new ol.layer.Vector({source:t});map.addLayer(r)},this.KMLMessage="Se agrego la capa exitosamente",o.readAsText(e)},kmlChange(){this.kmlNew=$("#filekml")[0].files[0].name},addKML2(){var e=new ol.layer.Vector({source:new ol.source.Vector({url:this.kmlNew,format:new ol.format.KML,crossOrigin:"anonymous"}),opacity:.7});map.addLayer(e),this.KMLMessage="Se agrego la capa exitosamente";var o={};o.id_capa=-controlCapaStore.data.capas.length,o.tabla_capa="",o.nomb_capa=this.kmlNameNew,o.id_grupo=-1,o.grupo="Capas externas",o.checked=!0;var a=!1;if(controlCapaStore.data.super_grupos.forEach(e=>{"Capas externas"==e.nombre&&(a=!0)}),!a){var t={id:0,nombre:"Capas externas"};controlCapaStore.data.super_grupos.push(t)}var r=!1;if(controlCapaStore.data.grupos.forEach(e=>{"Capas externas"==e.grupo&&(r=!0)}),!r){t={id_grupo:-1,grupo:"Capas externas",id_super_grupo:0,name_visible:!1};controlCapaStore.data.grupos.push(t)}controlCapaStore.data.capas.push(o),controlCapaStore.data.capaMap.push({capa:e,nombre:this.kmlNameNew}),controlCapaStore.data.capaVisible.push({capa:e,nomb_capa:this.kmlNameNew,visible:!0})}},created(){}}),new Vue({el:"#app",data:{loginStore:loginStore.data,infoLayerStore:infoLayerStore.data,username:"",userpassword:"",loginStatus:""},methods:{login(){this.loginStatus="",loginStore.methods.login(this.username,this.userpassword).then(e=>{"OK"==e.Result&&(this.loginStore.userLogged=!0)}).catch(e=>{this.loginStatus=e})},showLogin(){this.loginStore.userLogged=!1},logout(){location.reload()}},computed:{inf_fotos(){return this.infoLayerStore.infos.filter(e=>"foto"==e.tipo)},inf_videos(){return this.infoLayerStore.infos.filter(e=>"video"==e.tipo)},inf_mapas(){return this.infoLayerStore.infos.filter(e=>"mapa"==e.tipo)},inf_graficos(){return this.infoLayerStore.infos.filter(e=>"grafico"==e.tipo)},inf_docs(){return this.infoLayerStore.infos.filter(e=>"documento"==e.tipo)},inf_infografias(){return this.infoLayerStore.infos.filter(e=>"infografia"==e.tipo)}},created(){this.loginStatus=""}}),$(function(){"use strict";$(function(){$(".preloader").fadeOut()}),jQuery(document).on("click",".mega-dropdown",function(e){e.stopPropagation()});var e=function(){(window.innerWidth>0?window.innerWidth:this.screen.width)<500?($("body").addClass("mini-sidebar"),$(".navbar-brand span").hide(),$(".scroll-sidebar, .slimScrollDiv").css("overflow-x","visible").parent().css("overflow","visible"),$(".sidebartoggler i").addClass("ti-menu")):($("body").removeClass("mini-sidebar"),$(".navbar-brand span").show(),$(".sidebartoggler i").removeClass("ti-menu"));var e=(window.innerHeight>0?window.innerHeight:this.screen.height)-1;(e-=70)<1&&(e=1),e>70&&$(".page-wrapper").css("min-height",e+"px")};$(window).ready(e),$(window).on("resize",e),$(".fix-header .topbar").stick_in_parent({}),$(".nav-toggler").click(function(){$("body").toggleClass("show-sidebar"),$(".nav-toggler i").toggleClass("ti-menu"),$(".nav-toggler i").addClass("ti-close")}),$(".sidebartoggler").on("click",function(){$(".sidebartoggler i").toggleClass("ti-menu")}),$(function(){for(var e=window.location,o=$("ul#sidebarnav a").filter(function(){return this.href==e}).addClass("active").parent().addClass("active");o.is("li");)o=o.parent().addClass("in").parent().addClass("active")}),$("#control-layer-btn").on("click",function(e){$(".list-menu, .menu-options>div").hide(),$(".menu-options").slideDown(),e.preventDefault()}),$("#search-spacial-btn").on("click",function(e){$(".list-menu, .menu-options>div").hide(),$(".search-spacial").show(),$(".menu-options").slideToggle(),e.preventDefault()}),$("#search-titular-btn").on("click",function(e){$(".list-menu, .menu-options>div").hide(),$(".search-titular").show(),$(".menu-options").slideToggle(),e.preventDefault()}),$(".btn-return-menu").on("click",function(e){$(".list-menu").slideToggle(),$(".menu-options").hide(),e.preventDefault()}),$("#base-map-btn").on("click",function(e){$(".list-menu, .menu-options>div").hide(),$(".base-map").show(),$(".menu-options").slideToggle(),e.preventDefault()}),$("#external-layer-btn").on("click",function(e){$(".list-menu, .menu-options>div").hide(),$(".external-layer").show(),$(".menu-options").slideToggle(),e.preventDefault()}),$("#nav-acotar").on("click",function(){t("#modalAcotar")}),$("#nav-solicitud").on("click",function(){t("#modalSolicitud")}),$("#nav-ases-legal").on("click",function(){t("#modalAsesoriaLegal")}),$("#nav-asig-tecn").on("click",function(){t("#modalAsignarTecnico")}),$("#nav-expedientes").on("click",function(){t("#modalExpedientes")}),$("#nav-liquidacion").on("click",function(){t("#modalLiquidacion")}),$("#nav-resolucion").on("click",function(){t("#modalResolucion")}),$("#nav-infLayer").on("click",function(){t("#modalInfoLayer")}),$("#app").on("click","#nav-infLayer",function(){t("#modalInfoLayer")}),$("#nav-privilege").on("click",function(){t("#modalPrivilege")}),$("#nav-legend").on("click",function(){t("#modalLegend")}),$("#nav-configLayer").on("click",function(){t("#modalConfigLayer")}),$("#app").on("click","#nav-configLayer",function(){t("#modalConfigLayer")}),$("#nav-rol").on("click",function(){t("#modalRol")}),$("#nav-basemap").on("click",function(){t("#modalBaseMap")});var o=!1;$("#nav-fue").on("click",function(){t("#modalFue"),o||($(".nav-fue").scrollingTabs(),o=!0)});var a=!1;function t(e){$(e).addClass("modal-show"),$(e).draggable({handle:".modal-header"}),$("body").hasClass("show-sidebar")&&($("body").removeClass("show-sidebar"),$(".ti-close").addClass("ti-menu"))}$("#nav-fuhu").on("click",function(){t("#modalFuhu"),a||($(".nav-fuhu").scrollingTabs(),a=!0)}),$("#nav-externalLayer").on("click",function(){t("#modalExternalLayer")}),$("#nav-busquedaEsp").on("click",function(){t("#modalSearchSpacial")}),$("#nav-busquedaEspSa").on("click",function(){t("#modalSearchSpacialSa")}),$("#nav-busquedaIntSa").on("click",function(){t("#modalSearchIntervTable")}),$("#nav-busquedaTit").on("click",function(){t("#modalSearchTitular")}),$("#idCoor").on("click",function(){t("#modalCoordenadas")}),$("#nav-contacto").on("click",function(){t("#modalContacto")}),$("#nav-wmskml").on("click",function(){t("#modalWMSKML")}),$("#nav-fiscalizacion").on("click",function(){t("#modalFiscalizacion")}),$("#app").on("click",'.modal .close[data-dismiss="modal"]',function(e){$(this).parents(".modal").removeClass("modal-show")}),$("#app").on("click",".modal",function(e){$(".modal").css("z-index",1050),$(this).css("z-index",1051)}),$(".scroll-sidebar").slimScroll({position:"left",size:"5px",height:"100%",color:"#dcdcdc"}),$("body").trigger("resize"),$(".pop-up-close").on("click",function(){$(this).parent().hide()}),$("#app").on("click",".last-tab",function(){let e=$(this).parents(".modal-dialog");$(e).find(".modal-footer").show()});var r=!1,s=!1;$("#app").on("click",".btn-visualizar",function(e){var o=this.getAttribute("data-visualizar");fuStore.methods.loadExpediente(o).then(()=>{var e=fuStore.data.expediente.id_tipo_formulario;"1"==e?(fueStore.data.show_id_expediente=o,fueStore.methods.buscarExpediente(),$("#modalFueShow").addClass("modal-show"),$("#modalFueShow").draggable({handle:".modal-header"}),s||($(".nav-fue-show").scrollingTabs(),s=!0)):"2"==e&&(fuhuStore.data.show_id_expediente=o,fuhuStore.methods.buscarExpediente(),$("#modalFuhuShow").addClass("modal-show"),$("#modalFuhuShow").draggable({handle:".modal-header"}),r||($(".nav-fuhu-show").scrollingTabs(),r=!0))},()=>{alert("No se pudo obtener el expediente deseado")})}),$("#app").on("click",".openOps",function(){$(this).toggleClass("show")}),$("#app").on("keydown",".v-alph input",function(e){if(!e.key.match(/^[0-9a-zA-ZÑñ ]+$/))return!1}),$("#app").on("keydown",".v-time input",function(e){if(!e.key.match(/^[0-9a-zA-ZÑñ ]+$/))return!1}),$("#app").on("keydown",'input[type="number"]',function(e){if(parseInt(e.target.max)<parseInt(e.target.value+""+e.key))return!1}),$("#app").on("click",".place-icon",function(e){$(this).parent().toggleClass("active"),e.preventDefault()}),$("#app").on("change",'.placeCheck input[type="checkbox"]',function(e){var o=$(this).prop("checked"),a=$(this).parent().parent();a.siblings();a.find('input[type="checkbox"]').prop({indeterminate:!1,checked:o}),function e(a){var t=a.parent(),r=!0;a.siblings().each(function(){return r=$(this).find('input[type="checkbox"]').prop("checked")==o}),r&&o?(t.siblings().children('input[type="checkbox"]').prop({indeterminate:!1,checked:o}),e(t)):r&&!o?(t.siblings().children('input[type="checkbox"]').prop("checked",o),t.siblings().children('input[type="checkbox"]').prop("indeterminate",t.find('input[type="checkbox"]:checked').length>0),e(t.parent())):a.parent().siblings().children('input[type="checkbox"]').prop({indeterminate:!0,checked:!1})}(a)})});var osm=new ol.layer.Tile({preload:1/0,source:new ol.source.OSM}),bingKey="ApTJzdkyN1DdFKkRAE6QIDtzihNaf6IWJsT-nQ_2eMoO4PN__0Tzhl2-WgJtXFSp",bing=new ol.layer.Tile({preload:1/0,source:new ol.source.BingMaps({key:bingKey,imagerySet:"Road"}),visible:!1}),bingAerial=new ol.layer.Tile({preload:1/0,source:new ol.source.BingMaps({key:bingKey,imagerySet:"AerialWithLabels"}),visible:!1}),topografico=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),natgeo=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),imagery=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),imageryLabels=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),oceanos=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),darkgrey=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),lightgray=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),terrenoLabels=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),calles=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"}),visible:!1}),google2=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://www.google.com">Google, 2015</a>',url:"http://mt1.google.com/vt/lyrs=m&hl=es&gl=es&x={x}&y={y}&z={z}&s=png"}),visible:!1}),googles2=new ol.layer.Tile({source:new ol.source.XYZ({attributions:'Tiles © <a href="https://www.google.com">Google, 2015</a>',url:"http://mt1.google.com/vt/lyrs=s&hl=es&gl=es&x={x}&y={y}&z={z}&s=png"}),visible:!1}),scaleLineControl=new ol.control.ScaleLine({units:"metric",minWidth:100}),mousePositionControl=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",className:"custom-mouse-position",target:document.getElementById("lblCoordinate"),undefinedHTML:"&nbsp;"}),projectionSelect=document.getElementById("spatialReference");projectionSelect.addEventListener("change",function(e){mousePositionControl.setProjection(e.target.value)});var overviewMap=new ol.control.OverviewMap({collapsed:!0,label:"«",collapseLabel:"»",layers:[osm,bing,topografico,natgeo,imagery,oceanos,darkgrey,lightgray,terrenoLabels,calles,google2,googles2],view:new ol.View({center:ol.proj.transform([-74.41177369,-9.65914919],"EPSG:4326","EPSG:3857"),zoom:6})}),listLayers=[osm,bing,bingAerial,topografico,natgeo,imagery,oceanos,darkgrey,lightgray,terrenoLabels,calles,google2,googles2],map=new ol.Map({layers:listLayers,target:"map",controls:ol.control.defaults({zoom:!1,rotate:!1,attribution:!1,attributionOptions:{collapsible:!1}}).extend([scaleLineControl,overviewMap,mousePositionControl]),view:new ol.View({center:ol.proj.transform([-74.41177369,-9.65914919],"EPSG:4326","EPSG:3857"),zoom:6})});overviewMap.render();var draw,snapDraw,dragZoom=new ol.interaction.DragZoom,el_popup=document.getElementById("popup"),popup=new ol.Overlay({element:el_popup,autoPan:!0});map.addOverlay(popup),$("#zoom-out").click(function(){var e=map.getView(),o=e.getZoom();e.animate({zoom:o-1,duration:500})}),$("#zoom-in").click(function(){var e=map.getView(),o=e.getZoom();e.animate({zoom:o+1,duration:500})}),$("#zoomMax").click(function(){var e=map.getView(),o=ol.proj.get("EPSG:3857"),a=ol.proj.get("EPSG:4326"),t=ol.proj.transform([-74.41177369,-9.65914919],a,o);e.animate({zoom:5,center:t,duration:500})}),$("#geolocMap").click(function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var o=map.getView(),a=ol.proj.get("EPSG:3857"),t=ol.proj.get("EPSG:4326"),r=ol.proj.transform([e.coords.longitude,e.coords.latitude],t,a);o.animate({zoom:17,center:r,duration:500})})}),$("#zoomBox, #measure, #draw").click(function(){$(this).find(".map-option-list").slideToggle()});var drawSource=new ol.source.Vector({wrapX:!1,crossOrigin:"anonymous"}),vectorDraw=new ol.layer.Vector({source:drawSource});map.addLayer(vectorDraw);var modifyDraw=new ol.interaction.Modify({source:drawSource});function drawMap(e){draw=new ol.interaction.Draw({source:drawSource,type:e}),map.addInteraction(draw),snapDraw=new ol.interaction.Snap({source:drawSource}),map.addInteraction(snapDraw)}map.addInteraction(modifyDraw),$("#draw li").on("click",function(){removeInteractions(),drawMap($(this).data("draw-type"))}),$("#mapImg").click(function(){removeInteractions(),map.once("postcompose",function(e){var o=e.context.canvas;navigator.msSaveBlob?navigator.msSaveBlob(o.msToBlob(),"map.png"):o.toBlob(function(e){saveAs(e,"map.png")})}),map.renderSync()});var drawMeasure,sketch,helpTooltipElement,helpTooltip,measureTooltipElement,measureTooltip,loading=0,loaded=0;$("#mapPdf").click(function(){document.body.style.cursor="progress",removeInteractions();var e=[297,210],o=Math.round(150*e[0]/25.4),a=Math.round(150*e[1]/25.4),t=map.getSize(),r=map.getView().calculateExtent(t);if(osm.getVisible())var s=osm.getSource();else if(bing.getVisible())s=bing.getSource();else if(bingAerial.getVisible())s=bingAerial.getSource();else s=vectorDraw.getSource();var n=function(){++loading},i=function(){if(loading===++loaded){var o=this;window.setTimeout(function(){loading=0,loaded=0;var a=o.toDataURL("image/png"),p=new jsPDF("landscape",void 0,"a4");p.addImage(a,"JPEG",0,0,e[0],e[1]),p.save("map.pdf"),s.un("tileloadstart",n),s.un("tileloadend",i,o),s.un("tileloaderror",i,o),map.setSize(t),map.getView().fit(r),map.renderSync(),document.body.style.cursor="auto"},100)}};map.once("postcompose",function(e){s.on("tileloadstart",n),s.on("tileloadend",i,e.context.canvas),s.on("tileloaderror",i,e.context.canvas)}),map.setSize([o,a]),map.getView().fit(r),map.renderSync()}),ol.control.NavigationHistory=function(e){var o=e||{},a=this;$("#prevView").on("click",function(){var e=a.get("history"),o=a.get("index");o>0&&(o-=1,a.setProperties({shouldSave:!1,index:o}),map.getView().setProperties(e[o]))}),$("#prevView").disabled=!0,$("#nextView").on("click",function(){var e=a.get("history"),o=a.get("index");o<e.length-1&&(o+=1,a.setProperties({shouldSave:!1,index:o}),map.getView().setProperties(e[o]))}),$("#nextView").disabled=!0,ol.control.Control.call(this,{element:$("#map-options"),target:o.target}),this.setProperties({history:[],index:-1,maxSize:o.maxSize||50,eventId:null,shouldSave:!0}),this.on("change:index",function(){0===this.get("index")?$("#prevView").disabled=!0:$("#prevView").disabled=!1,this.get("history").length-1===this.get("index")?$("#nextView").disabled=!0:$("#nextView").disabled=!1}),map.on("moveend",function(e){if(a.get("shouldSave")){var o=map.getView(),t={center:o.getCenter(),resolution:o.getResolution(),rotation:o.getRotation()},r=a.get("history"),s=a.get("index");r.splice(s+1,r.length-s-1),r.length===a.get("maxSize")?r.splice(0,1):s+=1,r.push(t),a.set("index",s)}else a.set("shouldSave",a)})},ol.inherits(ol.control.NavigationHistory,ol.control.Control),new ol.control.NavigationHistory;var continuePolygonMsg="Click para continuar dibujando el poligono",continueLineMsg="Click para continuar dibujando la linea",statusMeasure=0,pointerMoveHandler=function(e){if(statusMeasure&&!e.dragging){var o="Click para empezar a dibujar";if(sketch){var a=sketch.getGeometry();a instanceof ol.geom.Polygon?o=continuePolygonMsg:a instanceof ol.geom.LineString&&(o=continueLineMsg)}helpTooltipElement.innerHTML=o,helpTooltip.setPosition(e.coordinate),helpTooltipElement.classList.remove("hide")}};map.on("pointermove",pointerMoveHandler),map.getViewport().addEventListener("mouseout",function(){statusMeasure&&helpTooltipElement.classList.add("hide")});var formatLength=function(e){var o=ol.Sphere.getLength(e);return o>100?Math.round(o/1e3*100)/100+" km":Math.round(100*o)/100+" m"},formatArea=function(e){var o=ol.Sphere.getArea(e);return o>1e4?Math.round(o/1e6*100)/100+" km<sup>2</sup>":Math.round(100*o)/100+" m<sup>2</sup>"};function addInteractionMeasure(e){var o;drawMeasure=new ol.interaction.Draw({source:drawSource,type:e,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}),map.addInteraction(drawMeasure),createMeasureTooltip(),createHelpTooltip(),drawMeasure.on("drawstart",function(e){sketch=e.feature;var a=e.coordinate;o=sketch.getGeometry().on("change",function(e){var o,t=e.target;t instanceof ol.geom.Polygon?(o=formatArea(t),a=t.getInteriorPoint().getCoordinates()):t instanceof ol.geom.LineString&&(o=formatLength(t),a=t.getLastCoordinate()),measureTooltipElement.innerHTML=o,measureTooltip.setPosition(a)})},this),drawMeasure.on("drawend",function(){measureTooltipElement.className="tooltip tooltip-static",measureTooltip.setOffset([0,-7]),sketch=null,measureTooltipElement=null,createMeasureTooltip(),ol.Observable.unByKey(o)},this)}function createHelpTooltip(){helpTooltipElement&&helpTooltipElement.parentNode.removeChild(helpTooltipElement),(helpTooltipElement=document.createElement("div")).className="tooltip hide",helpTooltip=new ol.Overlay({element:helpTooltipElement,offset:[15,0],positioning:"center-left"}),map.addOverlay(helpTooltip)}function createMeasureTooltip(){measureTooltipElement&&measureTooltipElement.parentNode.removeChild(measureTooltipElement),(measureTooltipElement=document.createElement("div")).className="tooltip tooltip-measure",measureTooltip=new ol.Overlay({element:measureTooltipElement,offset:[0,-15],positioning:"bottom-center"}),map.addOverlay(measureTooltip)}function removeInteractions(){map.removeInteraction(draw),map.removeInteraction(drawH),map.removeInteraction(snapDraw),map.removeInteraction(snapDrawH),map.removeInteraction(drawMeasure)}$("#measure li").on("click",function(){removeInteractions(),statusMeasure=1,addInteractionMeasure($(this).data("measure-type"))}),$("#navMap").click(function(){removeInteractions(),$(helpTooltipElement).hasClass("hide")||$(helpTooltipElement).addClass("hide"),statusMeasure=0});var drawH,snapDrawH,iconFeature,iconfeaturen,terrenoMap,sourceHouse=new ol.source.Vector({wrapX:!1,crossOrigin:"anonymous"}),vectorHouse=new ol.layer.Vector({source:sourceHouse});function drawHouse(e){drawH=new ol.interaction.Draw({source:sourceHouse,type:e,style:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:.95,src:"assets/images/icon.png"})})}),map.addInteraction(drawH),snapDrawH=new ol.interaction.Snap({source:sourceHouse}),map.addInteraction(snapDrawH)}terrenoMap=!1,map.addLayer(vectorHouse),$("body").on("click",".ubicar_lonlat",function(){removeInteractions(),drawHouse("Point")}),map.on("click",function(e){if(terrenoMap){var o=ol.proj.transform(e.coordinate,"EPSG:3857","EPSG:4326"),a=o[0],t=o[1];$(".lon-map").val(a),$(".lat-map").val(t),iconFeature=new ol.Feature({geometry:new ol.geom.Point(e.coordinate),name:"Null Island",population:4e3,rainfall:500});var r=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"assets/images/icon.png"})});iconFeature.setStyle(r),sourceHouse.clear(),sourceHouse.addFeature(iconFeature)}});